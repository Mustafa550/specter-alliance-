<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mega E-Ticaret Platformu</title>
<style>
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f4f4f9;
    color: #333;
  }
  header {
    background: #0d6efd;
    color: white;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header h1 {
    margin: 0;
    font-size: 24px;
  }
  header nav button {
    margin-left: 10px;
    padding: 8px 14px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
  }
  header nav button.login-btn { background: #198754; color: white; }
  header nav button.register-btn { background: #ffc107; color: black; }
  header nav button.logout-btn { background: #dc3545; color: white; }
  main {
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 15px;
  }
  .categories {
    margin-bottom: 20px;
  }
  .categories button {
    margin-right: 10px;
    margin-bottom: 10px;
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    background: #6c757d;
    color: white;
    cursor: pointer;
  }
  .categories button.active { background: #0d6efd; }
  #product-list {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
  }
  .card {
    background: white;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    padding: 15px;
    width: 250px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .card img {
    width: 100%;
    height: 150px;
    object-fit: contain;
    margin-bottom: 10px;
  }
  .card h3 { margin: 0 0 8px 0; font-size: 18px; }
  .card p { margin: 0 0 8px 0; font-size: 14px; }
  .card button {
    background: #0d6efd;
    color: white;
    border: none;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 4px;
    margin-top: auto;
  }
  .card button:disabled { background: #6c757d; cursor: not-allowed; }
  #cart-section {
    background: #e9ecef;
    padding: 15px;
    border-radius: 6px;
    margin-top: 30px;
  }
  #cart-items {
    list-style: none;
    padding-left: 0;
    margin-bottom: 10px;
    max-height: 200px;
    overflow-y: auto;
  }
  #cart-items li {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid #ccc;
  }
  #cart-items li button {
    background: #dc3545;
    border: none;
    color: white;
    cursor: pointer;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 14px;
    line-height: 18px;
    padding: 0;
    text-align: center;
  }
  #whatsapp-link {
    display: inline-block;
    background: #25D366;
    color: white;
    text-decoration: none;
    padding: 10px 15px;
    border-radius: 6px;
    margin-top: 10px;
  }
  #whatsapp-link:disabled {
    background: #a6d8a8;
    pointer-events: none;
  }
  .hidden { display: none !important; }
  form input, form textarea {
    width: 100%;
    padding: 8px;
    margin: 5px 0 10px 0;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  form button {
    background: #0d6efd;
    color: white;
    border: none;
    padding: 10px 12px;
    border-radius: 4px;
    cursor: pointer;
  }
  form button:hover { background: #0b5ed7; }
  .comments { margin-top: 10px; font-size: 13px; max-height: 120px; overflow-y: auto; border-top: 1px solid #ddd; padding-top: 5px; }
  .comment { border-bottom: 1px solid #eee; padding: 4px 0; }
  .comment-date { font-size: 11px; color: #666; margin-left: 5px; }
</style>
</head>
<body>

<header>
  <h1>MegaShop</h1>
  <nav id="nav-buttons">
    <button class="login-btn" id="btn-login">Giriş Yap</button>
    <button class="register-btn" id="btn-register">Kayıt Ol</button>
  </nav>
</header>

<main>
  <!-- Auth Section -->
  <div id="auth-section" class="hidden">
    <form id="login-form">
      <h2>Giriş Yap</h2>
      <input type="text" id="login-username" placeholder="Kullanıcı adı veya E-posta" required>
      <input type="password" id="login-password" placeholder="Şifre" required>
      <button type="submit">Giriş</button>
      <p><a href="#" id="forgot-password">Şifremi Unuttum</a></p>
    </form>
    <form id="register-form" class="hidden">
      <h2>Kayıt Ol</h2>
      <input type="email" id="register-email" placeholder="E-posta" required>
      <input type="text" id="register-username" placeholder="Kullanıcı adı" required>
      <input type="password" id="register-password" placeholder="Şifre (6+ karakter)" required>
      <button type="submit">Kayıt Ol</button>
    </form>
    <form id="reset-form" class="hidden">
      <h2>Şifre Sıfırlama</h2>
      <input type="email" id="reset-email" placeholder="Kayıtlı E-posta" required>
      <button type="submit">Sıfırlama Linki Gönder</button>
      <p><a href="#" id="back-to-login">Girişe Dön</a></p>
    </form>
  </div>

  <!-- Product Section -->
  <div id="shop-section" class="hidden">
    <div class="categories">
      <button data-cat="all" class="active">Tüm Kategoriler</button>
      <button data-cat="telefon">Telefon</button>
      <button data-cat="oyun">Oyun Hesapları</button>
      <button data-cat="aksesuar">Aksesuar</button>
      <button data-cat="yazilim">Yazılım</button>
    </div>

    <div id="product-list"></div>

    <div id="cart-section">
      <h2>Sepetim</h2>
      <ul id="cart-items"></ul>
      <p>Toplam: <span id="total">0</span> TL</p>
      <a id="whatsapp-link" href="#" target="_blank" rel="noopener noreferrer">WhatsApp ile Sipariş Gönder</a>
      <br>
      <button id="logout-btn" class="logout-btn">Çıkış Yap</button>
    </div>
  </div>
</main>

<script>
(() => {
  const products = [
    {id:1, name:"iPhone 13", price:12000, stock:10, category:"telefon", img:"https://cdn-icons-png.flaticon.com/512/3062/3062634.png"},
    {id:2, name:"Samsung Galaxy S22", price:10000, stock:15, category:"telefon", img:"https://cdn-icons-png.flaticon.com/512/888/888879.png"},
    {id:3, name:"Valorant Hesap", price:250, stock:20, category:"oyun", img:"https://cdn-icons-png.flaticon.com/512/5968/5968705.png"},
    {id:4, name:"Steam Hesap", price:300, stock:12, category:"oyun", img:"https://cdn-icons-png.flaticon.com/512/732/732200.png"},
    {id:5, name:"Gaming Mouse", price:450, stock:30, category:"aksesuar", img:"https://cdn-icons-png.flaticon.com/512/2301/2301122.png"},
    {id:6, name:"Mechanical Keyboard", price:700, stock:25, category:"aksesuar", img:"https://cdn-icons-png.flaticon.com/512/732/732212.png"},
    {id:7, name:"Photoshop Lisansı", price:1200, stock:5, category:"yazilim", img:"https://cdn-icons-png.flaticon.com/512/732/732221.png"},
    {id:8, name:"Microsoft Office", price:800, stock:10, category:"yazilim", img:"https://cdn-icons-png.flaticon.com/512/733/733579.png"}
  ];

  const LS_USER = "shop_user";
  const LS_CART = "shop_cart";
  const LS_USERS = "shop_users";
  const LS_COMMENTS = "shop_comments";

  const authSection = document.getElementById("auth-section");
  const shopSection = document.getElementById("shop-section");

  const loginForm = document.getElementById("login-form");
  const registerForm = document.getElementById("register-form");
  const resetForm = document.getElementById("reset-form");

  const btnLogin = document.getElementById("btn-login");
  const btnRegister = document.getElementById("btn-register");
  const forgotPassword = document.getElementById("forgot-password");
  const backToLogin = document.getElementById("back-to-login");
  const logoutBtn = document.getElementById("logout-btn");

  const productList = document.getElementById("product-list");
  const cartItemsEl = document.getElementById("cart-items");
  const totalEl = document.getElementById("total");
  const whatsappLink = document.getElementById("whatsapp-link");
  const categoryButtons = document.querySelectorAll(".categories button");

  let currentUser = null;
  let cart = [];
  let comments = {};

  function saveUsers(users){ localStorage.setItem(LS_USERS, JSON.stringify(users)); }
  function loadUsers(){ return JSON.parse(localStorage.getItem(LS_USERS)||"[]"); }
  function saveCurrentUser(u){ if(u)localStorage.setItem(LS_USER, JSON.stringify(u)); else localStorage.removeItem(LS_USER);}
  function loadCurrentUser(){ return JSON.parse(localStorage.getItem(LS_USER)||"null"); }
  function saveCart(c){ localStorage.setItem(LS_CART, JSON.stringify(c)); }
  function loadCart(){ return JSON.parse(localStorage.getItem(LS_CART)||"[]"); }
  function saveComments(c){ localStorage.setItem(LS_COMMENTS, JSON.stringify(c)); }
  function loadComments(){ return JSON.parse(localStorage.getItem(LS_COMMENTS)||"{}"); }

  function loginUser(username,password){ return loadUsers().find(u => (u.username===username || u.email===username) && u.password===password); }
  function registerUser(email,username,password){
    const users=loadUsers();
    if(users.some(u=>u.email===email))return {success:false,msg:"Bu e-posta zaten kayıtlı."};
    if(users.some(u=>u.username===username))return {success:false,msg:"Bu kullanıcı adı zaten alınmış."};
    users.push({email,username,password});
    saveUsers(users); return {success:true};
  }

  btnLogin.onclick=()=>{ authSection.classList.remove("hidden"); loginForm.classList.remove("hidden"); registerForm.classList.add("hidden"); resetForm.classList.add("hidden"); }
  btnRegister.onclick=()=>{ authSection.classList.remove("hidden"); registerForm.classList.remove("hidden"); loginForm.classList.add("hidden"); resetForm.classList.add("hidden"); }
  forgotPassword.onclick=(e)=>{ e.preventDefault(); loginForm.classList.add("hidden"); registerForm.classList.add("hidden"); resetForm.classList.remove("hidden"); }
  backToLogin.onclick=(e)=>{ e.preventDefault(); loginForm.classList.remove("hidden"); registerForm.classList.add("hidden"); resetForm.classList.add("hidden"); }

  resetForm.onsubmit=e=>{ e.preventDefault(); alert("Şifre sıfırlama linki gönderildi (demo)."); backToLogin.click(); }

  registerForm.onsubmit=e=>{
    e.preventDefault();
    const email=document.getElementById("register-email").value.trim();
    const username=document.getElementById("register-username").value.trim();
    const password=document.getElementById("register-password").value.trim();
    if(password.length<6)return alert("Şifre 6 karakterden kısa olamaz.");
    const res=registerUser(email,username,password);
    if(!res.success)return alert(res.msg);
    alert("Kayıt başarılı! Giriş yapabilirsiniz."); btnLogin.click();
  }

  loginForm.onsubmit=e=>{
    e.preventDefault();
    const username=document.getElementById("login-username").value.trim();
    const password=document.getElementById("login-password").value.trim();
    const user=loginUser(username,password);
    if(!user)return alert("Kullanıcı adı veya şifre yanlış.");
    currentUser=user; saveCurrentUser(user); loadApp();
  }

  logoutBtn.onclick=()=>{ currentUser=null; saveCurrentUser(null); cart=[]; saveCart(cart); comments={}; saveComments(comments); location.reload(); }

  function updateCart(){
    cartItemsEl.innerHTML=""; let toplam=0;
    cart.forEach(item=>{
      const p=products.find(u=>u.id===item.id);
      if(!p)return;
      const li=document.createElement("li");
      li.textContent=`${p.name} x${item.qty} - ${p.price*item.qty} TL`;
      const btnRemove=document.createElement("button"); btnRemove.textContent="X";
      btnRemove.onclick=()=>{ cart=cart.filter(c=>c.id!==item.id); saveCart(cart); renderProducts(); updateCart(); }
      li.appendChild(btnRemove); cartItemsEl.appendChild(li);
      toplam+=p.price*item.qty;
    });
    totalEl.textContent=toplam; updateWhatsappLink();
  }

  function updateWhatsappLink(){
    if(cart.length===0){ whatsappLink.href="#"; whatsappLink.style.pointerEvents="none"; whatsappLink.style.background="#a6d8a8"; return; }
    whatsappLink.style.pointerEvents="auto"; whatsappLink.style.background="#25D366";
    const text=cart.map(i=>{ const p=products.find(u=>u.id===i.id); return `${p.name} x${i.qty}`; }).join("\n");
    const msg=`Merhaba, aşağıdaki ürünlerden sipariş vermek istiyorum:\n${text}\nAdım: ${currentUser.username}\nE-posta: ${currentUser.email}`;
    whatsappLink.href=`https://wa.me/905426354386?text=${encodeURIComponent(msg)}`;
  }

  function renderProducts(category="all"){
    productList.innerHTML="";
    const filtered=category==="all"?products:products.filter(p=>p.category===category);
    filtered.forEach(p=>{
      const card=document.createElement("div"); card.className="card";
      const img=document.createElement("img"); img.src=p.img; img.alt=p.name;
      const title=document.createElement("h3"); title.textContent=p.name;
      const price=document.createElement("p"); price.textContent=`${p.price} TL`;
      const stock=document.createElement("p"); stock.textContent=p.stock>0?`Stok: ${p.stock}`:"Stokta Yok"; stock.style.color=p.stock>0?"green":"red";
      const commentsDiv=document.createElement("div"); commentsDiv.className="comments";
      const pComments=comments[p.id]||[];
      if(pComments.length===0){ const nc=document.createElement("p"); nc.textContent="Henüz yorum yok."; commentsDiv.appendChild(nc);}
      else pComments.forEach(c=>{ const cd=document.createElement("div"); cd.className="comment"; cd.innerHTML=`<strong>${c.user}</strong><span class="comment-date">(${new Date(c.date).toLocaleString()})</span><div class="comment-text">${c.text}</div>`; commentsDiv.appendChild(cd); });
      const commentForm=document.createElement("form"); commentForm.className="comment-form";
      const commentInput=document.createElement("textarea"); commentInput.placeholder="Yorum yazın..."; commentInput.required=true;
      const commentSubmit=document.createElement("button"); commentSubmit.type="submit"; commentSubmit.className="btn"; commentSubmit.textContent="Gönder";
      commentForm.appendChild(commentInput); commentForm.appendChild(commentSubmit);
      commentForm.onsubmit=e=>{ e.preventDefault(); const txt=commentInput.value.trim(); if(txt.length===0)return alert("Yorum boş olamaz."); if(!comments[p.id])comments[p.id]=[]; comments[p.id].push({user:currentUser.username,date:new Date().toISOString(),text:txt}); saveComments(comments); commentInput.value=""; renderProducts(category);}
      const addBtn=document.createElement("button"); addBtn.textContent=p.stock>0?"Sepete Ekle":"Stokta Yok"; addBtn.disabled=p.stock===0;
      addBtn.onclick=()=>{ const m=cart.find(c=>c.id===p.id); if(m){ if(m.qty<p.stock)m.qty++; else alert("Stok sınırına ulaşıldı."); } else cart.push({id:p.id,qty:1}); saveCart(cart); updateCart();}
      card.appendChild(img); card.appendChild(title); card.appendChild(price); card.appendChild(stock); card.append
card.appendChild(commentsDiv);
      card.appendChild(commentForm);
      card.appendChild(addBtn);
      productList.appendChild(card);
    });
  }

  // Kategori butonlarını bağla
  categoryButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      categoryButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const cat = btn.getAttribute('data-cat');
      renderProducts(cat);
    });
  });

  // LocalStorage fonksiyonları (kısa tekrar)
  function saveCartLocal() { saveCart(cart); }
  function loadCartLocal() { cart = loadCart(); }
  function loadCommentsLocal() { comments = loadComments(); }
  function loadUserLocal() { currentUser = loadCurrentUser(); }

  // Uygulama başlangıcı (UI kontrol, görünürlükler)
  function loadApp() {
    loadUserLocal();
    loadCartLocal();
    loadCommentsLocal();

    if (currentUser) {
      // Giriş yapılmış görünümü
      authSection.classList.add("hidden");
      shopSection.classList.remove("hidden");
      // header butonlarını gizle
      document.getElementById("nav-buttons").innerHTML = `<div style="display:flex;align-items:center;gap:10px">
        <strong style="color:white">${currentUser.username}</strong>
        <button id="nav-logout" class="logout-btn">Çıkış</button>
      </div>`;
      document.getElementById("nav-logout").onclick = () => {
        logoutBtn.click();
      };
    } else {
      // Giriş yapılmamış
      authSection.classList.remove("hidden");
      shopSection.classList.remove("hidden"); // site herkese açık, istediğin gibi
      // Show register/login in header
      document.getElementById("nav-buttons").innerHTML = `<button class="login-btn" id="btn-login">Giriş Yap</button>
        <button class="register-btn" id="btn-register">Kayıt Ol</button>`;
      // re-bind header buttons
      document.getElementById("btn-login").onclick = () => { authSection.classList.remove("hidden"); loginForm.classList.remove("hidden"); registerForm.classList.add("hidden"); resetForm.classList.add("hidden"); };
      document.getElementById("btn-register").onclick = () => { authSection.classList.remove("hidden"); registerForm.classList.remove("hidden"); loginForm.classList.add("hidden"); resetForm.classList.add("hidden"); };
    }

    // Render ürünler ve sepet
    renderProducts(document.querySelector('.categories button.active')?.getAttribute('data-cat') || 'all');
    updateCart();
  }

  // Kullanıcı kaydeden ve yükleyen yardımcı (başlangıçta örnek admin eklemek istersen)
  function ensureDefaultUsers() {
    const users = loadUsers();
    if (users.length === 0) {
      users.push({ email: 'admin@example.com', username: 'admin', password: 'admin1234' });
      users.push({ email: 'demo@example.com', username: 'demo', password: 'demo123' });
      saveUsers(users);
    }
  }

  // Yükleme ve başlangıç
  ensureDefaultUsers();
  loadApp();

  // Sayfada sağ altta sürekli cart toplamını güncelle (opsiyonel)
  setInterval(() => {
    updateCart();
  }, 5000);

  // Basit UX: dışarı tıklayınca auth formunu gizle (mobilde kolaylık)
  document.addEventListener('click', (e) => {
    const authArea = document.getElementById('auth-section');
    if (!authArea.contains(e.target) && !document.getElementById('nav-buttons').contains(e.target)) {
      // authSection.classList.add('hidden'); // yorumda bırakıyorum, istersen aç
    }
  });

  // Küçük güvenlik notu (client-side saklanan şifreler plaintext): Bu örnek sadece demo/yerel kullanım içindir.
  // Gerçek prod uygulamasında parolalar server tarafında bcrypt ile hashlenmeli, localStorage kullanılmamalıdır.

})(); // IIFE sonu
</script>

</body>
</html>